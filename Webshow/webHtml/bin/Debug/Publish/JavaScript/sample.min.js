var camera,controls,scene,renderer,labelRenderer,scene1,scene2,axesHelper,mesh,mapGroup,boundryGroup,peibianGroup,tongxin5GMapGroup,regionBlockGroup,lineGroup,lineLabelGroup,biandiansuoGroup,buildingsGroups,measureLengthGroup,measureAreaGroup,guangouGroup,chaoliufenxiGroup,chaoliufenxiGroup2,chaoliufenxiGroup3,chaoliufenxiGroup4,chaoliufenxiGroup5,songdianquGroup,runFromNginx=!1,aa=function(){return"showA Page:hello world!"},setMap=function(e){"e"==e?(mercatoCenter.zoom=-10,constMapt="e",updateMap()):"m"==e?(mercatoCenter.zoom=-10,constMapt="m",updateMap()):"r"==e&&(mercatoCenter.zoom=-10,constMapt="r",updateMap())},x_PI=52.35987755982988,centerPosition={lon:112.573463,lat:37.891474},mercatoCenter={x:0,zValue:0,zoom:0};!1===WEBGL.isWebGLAvailable()&&document.body.appendChild(WEBGL.getWebGLErrorMessage());var light1,light2,light3,light4,raycaster,mapMesh,ctx,mapCanvas,chaoliufenxiGroupCount=10,chaoliuFenxiData=[],mapGroupData={},constMapt="e",clickState="objClick",measureLengthObj={start:{x:0,y:0},end:{x:0,y:0},state:0,getAngleF:function(e,a,r,i){var o=Math.sqrt((r-e)*(r-e)+(i-a)*(i-a));return 0<o?0<r-e?Math.asin((i-a)/o):Math.PI-Math.asin((i-a)/o):0},result:0,measureLineDiv:null,measureLineDivLabel:null},measureAreaObj={points:[],measureAreaDiv:null,measureAreaDivLabel:null};function init(){(scene=new THREE.Scene).background=new THREE.Color(8166868),scene.fog=new THREE.FogExp2(8166868,.002);var e=new THREE.CubeTextureLoader;e.setPath("Pic/");var a=e.load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"]);scene.background=a,(renderer=new THREE.WebGLRenderer({alpha:!0})).setClearColor(0,0),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.domElement.className="renderDom",document.getElementById("mainC").appendChild(renderer.domElement),(labelRenderer=new THREE.CSS2DRenderer).setSize(window.innerWidth,window.innerHeight),labelRenderer.domElement.className="labelRenderer",document.getElementById("mainC").appendChild(labelRenderer.domElement),(camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1e-4,1e3)).position.set(4e3,2e3,0),camera.position.set(MercatorGetXbyLongitude(centerPosition.lon),0,-MercatorGetYbyLatitude(centerPosition.lat)),(controls=new THREE.OrbitControls(camera,labelRenderer.domElement)).center.set(MercatorGetXbyLongitude(centerPosition.lon),0,-MercatorGetYbyLatitude(centerPosition.lat)),(axesHelper=new THREE.AxesHelper(265)).position.set(MercatorGetXbyLongitude(centerPosition.lon),0,-MercatorGetYbyLatitude(centerPosition.lat)),controls.enableDamping=!0,controls.dampingFactor=.25,controls.screenSpacePanning=!1,controls.minDistance=6,controls.maxDistance=96,controls.maxPolarAngle=Math.PI/2-Math.PI/6,controls.minPolarAngle=0;camera.position.set(MercatorGetXbyLongitude(centerPosition.lon),50*Math.sin(.4),50*Math.cos(.4)-MercatorGetYbyLatitude(centerPosition.lat)),mapGroup=new THREE.Group,scene.add(mapGroup),boundryGroup=new THREE.Group,scene.add(boundryGroup),peibianGroup=new THREE.Group,scene.add(peibianGroup),tongxin5GMapGroup=new THREE.Group,scene.add(tongxin5GMapGroup),regionBlockGroup=new THREE.Group,scene.add(regionBlockGroup),lineGroup=new THREE.Group,scene.add(lineGroup),lineLabelGroup=new THREE.Group,scene.add(lineLabelGroup),biandiansuoGroup=new THREE.Group,scene.add(biandiansuoGroup),buildingsGroups=new THREE.Group,scene.add(buildingsGroups),measureLengthGroup=new THREE.Group,scene.add(measureLengthGroup),measureAreaGroup=new THREE.Group,scene.add(measureAreaGroup),guangouGroup=new THREE.Group,scene.add(guangouGroup),chaoliufenxiGroup=[];for(var r=0;r<chaoliufenxiGroupCount;r++){var i=new THREE.Group;chaoliufenxiGroup.push(i),chaoliuFenxiData.push([]),scene.add(i)}songdianquGroup=new THREE.Group,scene.add(songdianquGroup);var o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,.01,0)),o.vertices.push(new THREE.Vector3(1,.01,0));var n=new THREE.LineBasicMaterial({color:16777215,linewidth:10,side:THREE.DoubleSide}),t=new THREE.Line(o,n);measureLengthGroup.add(t),measureLengthObj.measureLineDiv=document.createElement("div"),measureLengthObj.measureLineDiv.className="label",measureLengthObj.measureLineDiv.textContent="Earth",measureLengthObj.measureLineDiv.style.marginTop="-1em",measureLengthObj.measureLineDivLabel=new THREE.CSS2DObject(measureLengthObj.measureLineDiv),measureLengthObj.measureLineDivLabel.position.set(0,0,0),measureLengthGroup.add(measureLengthObj.measureLineDivLabel),measureAreaObj.measureAreaDiv=document.createElement("div"),measureAreaObj.measureAreaDiv.className="label",measureAreaObj.measureAreaDiv.textContent="Earth",measureAreaObj.measureAreaDiv.style.marginTop="-1em",measureAreaObj.measureAreaDivLabel=new THREE.CSS2DObject(measureAreaObj.measureAreaDiv),measureAreaObj.measureAreaDivLabel.position.set(0,0,0),measureAreaGroup.add(measureAreaObj.measureAreaDivLabel);for(new THREE.CylinderBufferGeometry(0,10,30,4,1),new THREE.MeshPhongMaterial({color:16777215,flatShading:!0}),r=0;r<500;r++);(light1=new THREE.PointLight(16777215)).position.set(0,9e4,0),light1.intensity=.7,scene.add(light1),(light2=new THREE.PointLight(16777215)).position.set(0,9e4,-18e4),light2.intensity=.7,scene.add(light2),(light3=new THREE.PointLight(16777215)).position.set(18e4,9e4,-18e4),light3.intensity=.7,scene.add(light3),(light4=new THREE.PointLight(16777215)).position.set(18e4,9e4,18e4),light4.intensity=.7,scene.add(light4),(raycaster=new THREE.Raycaster).linePrecision=10,mouse=new THREE.Vector2,document.addEventListener("click",onDocumentClick),document.addEventListener("mousemove",onDocumentMouseMove,!1),window.addEventListener("resize",onWindowResize,!1),mapGroup.renderOrder=0,boundryGroup.renderOrder=9,lineGroup.renderOrder=9,biandiansuoGroup.renderOrder=9,peibianGroup.renderOrder=9,tongxin5GMapGroup.renderOrder=9,regionBlockGroup.renderOrder=9,buildingsGroups.renderer=10}function onDocumentRightClick(e){if("areaMeasure"==clickState&&(mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),1e-7<Math.abs(raycaster.ray.direction.y))){for(var a=-raycaster.ray.origin.y/raycaster.ray.direction.y,r=raycaster.ray.origin.x+a*raycaster.ray.direction.x,i=raycaster.ray.origin.z+a*raycaster.ray.direction.z,o=1e8,n=-1,t=0;t<measureAreaObj.points.length;t++){var s=Math.sqrt((r-measureAreaObj.points[t].x)*(r-measureAreaObj.points[t].x)+(i-measureAreaObj.points[t].z)*(i-measureAreaObj.points[t].z));s<o&&(o=s,n=t)}0<=n&&measureAreaObj.points.splice(n,1),drawMeasuredArea()}}function onDocumentClick(e){if("objClick"==clickState){mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera);var a=1e8,r=null,i="";if(peibianGroup.visible)if(0<(t=raycaster.intersectObjects(peibianGroup.children)).length)for(var o=0;o<t.length;o++)t[o].distance<a&&(r=t[o].object,i="peibian",a=t[o].distance);if(tongxin5GMapGroup.visible)if(0<(t=raycaster.intersectObjects(tongxin5GMapGroup.children)).length)for(o=0;o<t.length;o++)t[o].distance<a&&(r=t[o].object,i="tongxin5G",a=t[o].distance);if(regionBlockGroup.visible)if(0<(t=raycaster.intersectObjects(regionBlockGroup.children)).length)for(o=0;o<t.length;o++)t[o].distance<a&&(r=t[o].object,i="regionBlock",a=t[o].distance);if(lineGroup.visible){var n=[];for(o=0;o<lineGroup.children.length;o++)"Line"==lineGroup.children[o].type&&n.push(lineGroup.children[o]);var t;if(0<(t=raycaster.intersectObjects(n)).length)for(o=0;o<t.length;o++)t[o].distance<a&&(r=t[o].object,i="line",a=t[o].distance)}if(biandiansuoGroup.visible)if(0<(t=raycaster.intersectObjects(biandiansuoGroup.children)).length)for(o=0;o<t.length;o++)t[o].distance<a&&(r=t[o].object,i="line",a=t[o].distance);if(null!=r){var s=JSON.stringify({command:"showInformation",selectType:i,Tag:r.Tag});top.postMessage(s,"*"),console.log("iframe外发送信息",s)}}else if("lengthMeasure"==clickState){if(mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),1e-7<Math.abs(raycaster.ray.direction.y)){var u=-raycaster.ray.origin.y/raycaster.ray.direction.y,l={x:raycaster.ray.origin.x+u*raycaster.ray.direction.x,z:raycaster.ray.origin.z+u*raycaster.ray.direction.z};0==measureLengthObj.state?(measureLengthObj.start.x=l.x,measureLengthObj.start.y=-l.z,measureLengthObj.end.x=l.x+.001,measureLengthObj.end.y=-l.z-.001,measureLengthObj.state=1):1==measureLengthObj.state&&(.002<Math.abs(l.x-measureLengthObj.end.x)&&(measureLengthObj.end.x=l.x),.002<Math.abs(measureLengthObj.end.y+l.z)&&(measureLengthObj.end.y=-l.z),measureLengthObj.state=2)}}else if("areaMeasure"==clickState&&(randomV=2*Math.random()+.8,mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),1e-7<Math.abs(raycaster.ray.direction.y))){u=-raycaster.ray.origin.y/raycaster.ray.direction.y,l={x:raycaster.ray.origin.x+u*raycaster.ray.direction.x,z:raycaster.ray.origin.z+u*raycaster.ray.direction.z};measureAreaObj.points.push(l),drawMeasuredArea()}}var mouse=new THREE.Vector2;function onDocumentMouseMove(e){if("lengthMeasure"==clickState&&(mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),1e-7<Math.abs(raycaster.ray.direction.y))){var a=-raycaster.ray.origin.y/raycaster.ray.direction.y,r={x:raycaster.ray.origin.x+a*raycaster.ray.direction.x,z:raycaster.ray.origin.z+a*raycaster.ray.direction.z};0==measureLengthObj.state?(measureLengthObj.start.x=r.x,measureLengthObj.start.y=-r.z,measureLengthObj.end.x=r.x,measureLengthObj.end.y=-r.z):1==measureLengthObj.state&&(measureLengthObj.end.x=r.x,measureLengthObj.end.y=-r.z)}}var randomV=2*Math.random()+.8,updateLineMeasure=function(){if("lengthMeasure"==clickState){if(1==measureLengthObj.state||2==measureLengthObj.state){measureLengthGroup.children[0].position.set(measureLengthObj.start.x,.01,-measureLengthObj.start.y);var e=Math.sqrt((measureLengthObj.start.x-measureLengthObj.end.x)*(measureLengthObj.start.x-measureLengthObj.end.x)+(measureLengthObj.start.y-measureLengthObj.end.y)*(measureLengthObj.start.y-measureLengthObj.end.y));if(measureLengthGroup.children[0].scale.set(e,e,e),0<e){measureLengthObj.start.y,measureLengthObj.end.y;var a=measureLengthObj.getAngleF(measureLengthObj.start.x,measureLengthObj.start.y,measureLengthObj.end.x,measureLengthObj.end.y);measureLengthGroup.children[0].rotation.set(0,a,0)}measureLengthObj.result=getLengthOfTwoPoint(getBaiduPositionLon(measureLengthObj.start.x),getBaiduPositionLat(measureLengthObj.start.y),getBaiduPositionLon(measureLengthObj.end.x),getBaiduPositionLat(measureLengthObj.end.y)),measureLengthObj.measureLineDivLabel.position.set((measureLengthObj.start.x+measureLengthObj.end.x)/2,.1,-(measureLengthObj.start.y+measureLengthObj.end.y)/2);var r="";r=1e3<=measureLengthObj.result?10*Math.round(measureLengthObj.result/10)/1e3+"km":Math.round(measureLengthObj.result)+"m",measureLengthObj.measureLineDiv.textContent=r}}else if("areaMeasure"==clickState){for(var i=-1e6,o=1e6,n=-1e6,t=1e6,s=0,u=0,l=0;l<measureAreaObj.points.length;l++){measureAreaObj.points[l].x>i&&(i=measureAreaObj.points[l].x),measureAreaObj.points[l].x<o&&(o=measureAreaObj.points[l].x),measureAreaObj.points[l].z>n&&(n=measureAreaObj.points[l].z),measureAreaObj.points[l].z<t&&(t=measureAreaObj.points[l].z);var c=measureAreaObj.points[(l-1+measureAreaObj.points.length)%measureAreaObj.points.length],d=measureAreaObj.points[l];s+=c.x*d.z-c.z*d.x,u+=getLengthOfTwoPoint(getBaiduPositionLon(c.x),getBaiduPositionLat(-c.z),getBaiduPositionLon(d.x),getBaiduPositionLat(-d.z))}if(1<measureAreaObj.points.length){s/=2;var g=getLengthOfTwoPoint(getBaiduPositionLon(o),getBaiduPositionLat((-t-n)/2),getBaiduPositionLon(i),getBaiduPositionLat((-t-n)/2)),p=getLengthOfTwoPoint(getBaiduPositionLon((o+i)/2),getBaiduPositionLat(-t),getBaiduPositionLon((o+i)/2),getBaiduPositionLat(-n)),h=(getLengthOfTwoPoint(getBaiduPositionLon(o),getBaiduPositionLat(-t),getBaiduPositionLon(i),getBaiduPositionLat(-n)),Math.abs((i-o)*(n-t)));if(1e-5<h){s=s/h*(g*p);var m=1e3<u?Math.round(u/10)/100+"千米":Math.round(u)+"米",b=Math.abs(Math.round(s/1e3)/10)+"公顷";measureAreaObj.measureAreaDiv.textContent="周长："+m+",面积："+b+",负荷密度："+Math.round(u/100*randomV,2)+"兆瓦/平方公里"}else measureAreaObj.measureAreaDiv.textContent=" "}else measureAreaObj.measureAreaDiv.textContent=" ";measureAreaObj.measureAreaDivLabel.position.set((o+i)/2,.1,(t+n)/2)}};function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),labelRenderer.setSize(window.innerWidth,window.innerHeight)}var doC=!0;function animate(){doC&&(requestAnimationFrame(animate),controls.update(),updatePlaneLineScale(),updateMap(),updateScale(),updateLineMeasure(),animateChaoliuFenxi(),render(),labelRenderer.render(scene,camera))}function render(){renderer.clear(),renderer.render(scene,camera)}var updateMapContinue=!0,timeRocord=0,loadMap=function(){(new THREE.TextureLoader).load("Pic/eall19.jpg",function(e){var a=new THREE.MeshLambertMaterial({map:e}),r=new THREE.PlaneGeometry(91,80,1,1);(mesh=new THREE.Mesh(r,a)).position.set(97901.5,0,-35454),mesh.name="eall19",mapGroup.add(mesh)},void 0,function(e){console.error("An error happened.")})},namesShouldShow=[];function updateMap(){if(0<=Math.abs(timeRocord-Date.now())&&(timeRocord=Date.now(),updateMapContinue)){var e=Math.sqrt((camera.position.x-controls.target.x)*(camera.position.x-controls.target.x)+(camera.position.y-controls.target.y)*(camera.position.y-controls.target.y)+(camera.position.z-controls.target.z)*(camera.position.z-controls.target.z)),a=Math.round(22-Math.log2(e));19<a?a=19:a<10&&(a=10),camera.near=e,camera.far=2*e;var r,i=controls.target.x/Math.pow(2,19-a),o=controls.target.z/Math.pow(2,19-a);if(lineGroup.scale.set(1,e/50,1),biandiansuoGroup.scale.set(1,e/50,1),1<(mercatoCenter.zoom-a)*(mercatoCenter.zoom-a)+(mercatoCenter.zValue-o)*(mercatoCenter.zValue-o)+(mercatoCenter.x-i)*(mercatoCenter.x-i)){mercatoCenter.x=i,mercatoCenter.zValue=o,mercatoCenter.zoom=a;var n=[],t=o,s=a;r=[],i=Math.round(Math.floor(i)),t=-Math.round(Math.floor(t));for(var u=i-7;u<i+7;u++)for(var l=t-7;l<t+7;l++)n.push({x:u,y:l,z:s,t:constMapt}),r.push(constMapt+"_"+u+"_"+l+"_"+s);for(var c=function(e,a){if("no"==e)return!1;var i;i=a?JSON.parse(e):e,mapGroup.getObjectByName(i.n)||((new THREE.TextureLoader).load(i.img,function(e){var a=new THREE.MeshLambertMaterial({map:e});a.renderOrder=0;var r=new THREE.PlaneGeometry(1,1);(mesh=new THREE.Mesh(r,a)).position.set((i.x+.5)*Math.pow(2,19-i.z),0,0-(i.y+.5)*Math.pow(2,19-i.z)),mesh.rotateX(-Math.PI/2),mesh.scale.set(Math.pow(2,19-i.z),Math.pow(2,19-i.z),Math.pow(2,19-i.z)),mesh.name=i.n,mesh.renderOrder=0,mesh.visible=i.exit,mapGroup.getObjectByName(i.n)||mapGroup.add(mesh)},void 0,function(e){console.error("An error happened.")}),a&&(mapGroupData[i.n]||(mapGroupData[i.n]=i)));return!0},u=0;u<n.length;u++){var d=n[u].t+"_"+n[u].x+"_"+n[u].y+"_"+n[u].z,g=n[u].x,p=n[u].y,o=n[u].z,h=n[u].t;mapGroupData[d]?c(mapGroupData[d],!1):runFromNginx?$.get("MapPathText/"+n[u].t+n[u].x+"_"+n[u].y+"_"+n[u].z+".txt",n[u],function(e,a){c(e,!0)||(mapGroupData[d]=JSON.stringify({img:"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAeAB4AAD/4QBaRXhpZgAATU0AKgAAAAgABQMBAAUAAAABAAAASgMDAAEAAAABAAAAAFEQAAEAAAABAQAAAFERAAQAAAABAAASdFESAAQAAAABAAASdAAAAAAAAYagAACxj//bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicgIiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APf6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP//Z",x:g,y:p,z:o,t:h,n:d,exit:!1}))}):$.get("DAL/MapImage.ashx",n[u],function(e,a){c(e,!0)})}for(var u=mapGroup.children.length-1;0<=u;u--)r.indexOf(mapGroup.children[u].name)<0&&setTimeout(function(e){r.indexOf(e)<0&&mapGroup.remove(mapGroup.getObjectByName(e))},500,mapGroup.children[u].name);(16<=a?updateLabelOfLine:clearLabelOfLine)()}}}var testUpdateMap=function(){(new THREE.TextureLoader).load("Pic/e10_3_6.jpg",function(e){var a=Number.parseInt(prompt("输入",0));e.repeat.set(1,1),mapMesh.material[a]=new THREE.MeshBasicMaterial({map:e})})};function test(){$.get("http://localhost:2023/DAL/MapImage.ashx?x=10&y=3&z=6",function(e,a){alert("Data: "+e+"nStatus: "+a)})}function receiveMessage(e){var a=JSON.parse(e.data);switch(a.command){case"setMap":setMap(a.t);break;case"drawBoundry":drawBoundry(a.t);break;case"drawPeibian":drawPeibian(a.t);break;case"drawTongxin5G":drawTongxin5G(a.t);break;case"drawRegionBlock":drawRegionBlock(a.t);break;case"drawLine":drawLine(a.t);break;case"drawBiandiansuo":drawBiandiansuo(a.t);break;case"drawBuildings":drawBuildings(a.t);break;case"drawGuangou":drawLine2(a.t);break;case"drawChaoliufenxi":drawChaoliufenxi(a.t);break;case"drawSongdianquyu":drawSongdianquyu(a.t);break;case"search":switch(a.t){case"peibian":var r=a.keyWords;searchPeibian(r);break;case"tongxin5G":r=a.keyWords;searchTongxin5G(r);break;case"regionBlock":r=a.keyWords;searchRegionBlock(r);break;case"line":r=a.keyWords;searchLineByIndex(r);break;case"lineName":r=a.keyWords;searchLineByName(r);break;case"biandiansuo":r=a.keyWords;searchBiandiansuo(r);break;case"buildings":r=a.keyWords;searchBuildings(r);break;default:throw"没法处理："+e.data}return;case"measureLine":begainMeasureLength();break;case"measureArea":begainMeasureArea();break;case"measureCancle":measureCancle()}}function measureCancle(){clickState="objClick",measureLengthGroup.children[0].position.set(0,.01,0);measureLengthGroup.children[0].scale.set(1,1,1),measureLengthGroup.children[0].rotation.set(0,0,0),measureLengthObj.result=0,measureLengthObj.measureLineDivLabel.position.set(0,.1,0),measureLengthObj.measureLineDiv.textContent="";for(var e=measureAreaGroup.children.length-1;1<=e;e--)measureAreaGroup.remove(measureAreaGroup.children[e]);measureAreaObj.points=[],measureAreaObj.measureAreaDiv.textContent=" ",measureAreaObj.measureAreaDivLabel.position.set(0,.1,0)}function begainMeasureLength(){clickState="lengthMeasure",measureLengthObj.state=0,measureLengthObj.result=0}function begainMeasureArea(){clickState="areaMeasure";for(var e=measureAreaGroup.children.length-1;1<=e;e--)measureAreaGroup.remove(measureAreaGroup.children[e]);measureAreaObj.points=[]}window.addEventListener("message",receiveMessage,!1);var drawMeasuredArea=function(){if(0<measureAreaObj.points.length){for(var e=[],a=0;a<measureAreaObj.points.length;a++)e.push(measureAreaObj.points[a].x,.01,measureAreaObj.points[a].z);e.push(measureAreaObj.points[0].x,.01,measureAreaObj.points[0].z);var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.Float32BufferAttribute(e,3));var i=new THREE.LineBasicMaterial({color:"blue",linewidth:5}),o=new THREE.Line(r,i);1==measureAreaGroup.children.length?measureAreaGroup.add(o):measureAreaGroup.children[1].geometry=r}},drawBoundry=function(e){if("show"==e){if(boundryGroup.visible=!0,0==boundryGroup.children.length){for(var a=[],r=boundryData,i=0;i<r.length;i+=2){var o=r[i],n=r[i+1];a.push(MercatorGetXbyLongitude(o),0,-MercatorGetYbyLatitude(n))}var t,s,u;o=r[i=0],n=r[i+1];a.push(MercatorGetXbyLongitude(o),0,-MercatorGetYbyLatitude(n)),(t=new THREE.LineGeometry).setPositions(a),(s=new THREE.LineMaterial({color:showAConfig.boundry.color,linewidth:showAConfig.boundry.width})).renderOrder=9,s.depthTest=!1,(u=new THREE.Line2(t,s)).computeLineDistances(),u.renderOrder=0,u.scale.set(1,1,1),u.renderOrder=9,boundryGroup.add(u)}}else"hide"==e&&(boundryGroup.visible=!1)},drawPeibian=function(e){if("show"==e)if(peibianGroup.visible=!0,0==peibianGroup.children.length)for(var a=peibianData,r=new THREE.BoxBufferGeometry(.05,.05,.3),i=0;i<a.length;i++){var o=a[i].lon+.012846999999993614,n=a[i].lat+.006810000000001537+1e-4,t=(new THREE.Mesh(r,new THREE.MeshLambertMaterial({color:6736896,transparent:!0,opacity:.5})),MercatorGetXbyLongitude(o)),s=MercatorGetYbyLatitude(n),u=(r=new THREE.RingGeometry(.4,.1,12),new THREE.MeshBasicMaterial({color:6736896,side:THREE.DoubleSide,transparent:!0,opacity:.5}));u.depthTest=!1;var l=new THREE.Mesh(r,u);a[i].name=a[i].detail,l.Tag=a[i],l.renderOrder=98,l.position.set(t,0,-s),l.rotateX(Math.PI/2),peibianGroup.add(l)}else searchPeibian("BB");else"hide"==e&&(peibianGroup.visible=!1)},searchPeibian=function(e){for(var a=0;a<peibianGroup.children.length;a++)0<=peibianGroup.children[a].Tag.detail.search(e)?(peibianGroup.children[a].material.color.set(16776960),peibianGroup.children[a].material.opacity=.9):(peibianGroup.children[a].material.color.set(6736896),peibianGroup.children[a].material.opacity=.5);if(""==e)for(a=0;a<peibianGroup.children.length;a++)peibianGroup.children[a].material.color.set(6736896),peibianGroup.children[a].material.opacity=.5},searchTongxin5G=function(e){for(var a=0;a<tongxin5GMapGroup.children.length;a++)0<=tongxin5GMapGroup.children[a].Tag.detail.search(e)?(tongxin5GMapGroup.children[a].material.color.set(16776960),tongxin5GMapGroup.children[a].material.opacity=.9):(tongxin5GMapGroup.children[a].material.color.set(16711935),tongxin5GMapGroup.children[a].material.opacity=.6);if(""==e)for(a=0;a<tongxin5GMapGroup.children.length;a++)tongxin5GMapGroup.children[a].material.color.set(16711935),tongxin5GMapGroup.children[a].material.opacity=.6},drawTongxin5G=function(e){if("show"==e)if(tongxin5GMapGroup.visible=!0,0==tongxin5GMapGroup.children.length)for(var a=peibianData,r=new THREE.ConeGeometry(.04,.2,8),i=0;i<a.length;i++){var o=a[i].lon+.012846999999993614+.001*Math.cos(i),n=a[i].lat+.006810000000001537+1e-4+.001*Math.sin(i),t=MercatorGetXbyLongitude(o),s=MercatorGetYbyLatitude(n),u=(r=new THREE.RingGeometry(.8,.3,3),new THREE.MeshBasicMaterial({color:16711935,side:THREE.DoubleSide,transparent:!0,opacity:.7}));u.depthTest=!1;var l=new THREE.Mesh(r,u);a[i].name=a[i].detail,l.Tag=a[i],l.renderOrder=98,l.position.set(t,0,-s),l.rotateX(Math.PI/2),l.rotateZ(Math.PI/6),tongxin5GMapGroup.add(l)}else searchTongxin5G("BB");else"hide"==e&&(tongxin5GMapGroup.visible=!1)},recordL=0,updateScale=function(){var e=Math.sqrt((camera.position.x-controls.target.x)*(camera.position.x-controls.target.x)+(camera.position.y-controls.target.y)*(camera.position.y-controls.target.y)+(camera.position.z-controls.target.z)*(camera.position.z-controls.target.z));if(.01<=Math.abs(recordL-e)){if(recordL=e,raycaster.linePrecision=.02*recordL,peibianGroup.visible&&0<peibianGroup.children.length)for(var a=0;a<peibianGroup.children.length;a++)peibianGroup.children[a].scale.set(recordL/50,recordL/50,recordL/50);if(tongxin5GMapGroup.visible&&0<tongxin5GMapGroup.children.length)for(a=0;a<tongxin5GMapGroup.children.length;a++)tongxin5GMapGroup.children[a].scale.set(recordL/50,recordL/50,recordL/50)}},updatePlaneLineScale=function(){},drawRegionBlock=function(e){if("show"==e)if(regionBlockGroup.visible=!0,0==regionBlockGroup.children.length){function a(e,a){for(var r=16369.1554,i=67202.5534,o=20907.227,n=62778.341,t=112.540805,s=37.906085,u=112.592103,l=37.866438,c=e.geometry.coordinates,d=[],g=0;g<c.length;g++){var p=c[g][0],h=c[g][1],m=(p=t+(c[g][0]-r)/(o-r)*(u-t),h=l+(c[g][1]-n)/(i-n)*(s-l),MercatorGetXbyLongitude(p)),b=MercatorGetYbyLatitude(h)+.3;d.push(new THREE.Vector2(m,b))}var A=new THREE.Shape(d),G=new THREE.ExtrudeBufferGeometry(A,{depth:.3,bevelEnabled:!1}),y=6710784,L=["R","A","B","M","W","S","U","G"];switch(L[a%8]){case"R":y=6710784;break;case"A":y=13395558;break;case"B":y=10053324;break;case"M":y=16724736;break;case"W":y=10040166;break;case"S":y=16724940;break;case"U":y=10027008;break;case"G":y=16711782}var f=new THREE.MeshPhongMaterial({color:y,wireframe:!1,transparent:!0,opacity:.8});f.depthTest=!1;var K=new THREE.Mesh(G,f);K.position.set(0,0,0),K.rotateX(-Math.PI/2),K.scale.set(1,1,1),K.Tag={regionType:["居住用地","公共管理与公共服务设施用地","商业服务业设施用地","工业用地","物流仓储用地","道路与交通设施用地","公用设施用地","绿地与广场用地"][a%8],regionTypeSimple:L[a%8],rongjilv:99},K.renderOrder=97,regionBlockGroup.add(K)}for(var r=regionBlock3.features,i=0;i<r.length;i++)a(r[i],i)}else searchRegionBlock("BB");else"hide"==e&&(regionBlockGroup.visible=!1)},drawSongdianquyu=function(e){if("show"==e){if(songdianquGroup.visible=!0,0==songdianquGroup.children.length){function a(e,a){for(var r=16369.1554,i=67202.5534,o=20907.227,n=62778.341,t=112.540805,s=37.906085,u=112.592103,l=37.866438,c=e.geometry.coordinates,d=[],g=0;g<c.length;g++){var p=c[g][0],h=c[g][1],m=(p=t+(c[g][0]-r)/(o-r)*(u-t),h=l+(c[g][1]-n)/(i-n)*(s-l),MercatorGetXbyLongitude(p)),b=MercatorGetYbyLatitude(h)+.3;d.push(new THREE.Vector2(m,b))}var A=new THREE.Shape(d),G={depth:.01*a*.4,bevelEnabled:!1},y=new THREE.ExtrudeBufferGeometry(A,G),L=6710784,f=["R","A","B","M","W","S","U","G"];switch(f[a%8]){case"R":L=6710784;break;case"A":L=13395558;break;case"B":L=10053324;break;case"M":L=16724736;break;case"W":L=10040166;break;case"S":L=16724940;break;case"U":L=10027008;break;case"G":L=16711782}var K=new THREE.MeshPhongMaterial({color:L,wireframe:!1,transparent:!0,opacity:.8});K.depthTest=!1;var E=new THREE.Mesh(y,K);E.position.set(0,0,0),E.rotateX(-Math.PI/2),E.scale.set(1,1,1),E.Tag={regionType:["居住用地","公共管理与公共服务设施用地","商业服务业设施用地","工业用地","物流仓储用地","道路与交通设施用地","公用设施用地","绿地与广场用地"][a%8],regionTypeSimple:f[a%8],rongjilv:99},E.renderOrder=97,songdianquGroup.add(E)}for(var r=songdianquyu.features,i=0;i<r.length;i++)a(r[i],i);songdianquGroup.position.set(-25.32999999999998,0,11.699999999999987)}}else"hide"==e&&(songdianquGroup.visible=!1)},searchRegionBlock=function(e){for(var a=0;a<regionBlockGroup.children.length;a++)if(0<=regionBlockGroup.children[a].Tag.regionType.search(e))regionBlockGroup.children[a].material.color.set(16776960),regionBlockGroup.children[a].material.opacity=.9;else{var r=6710784;switch(regionBlockGroup.children[a].Tag.regionTypeSimple){case"R":r=6710784;break;case"A":r=13395558;break;case"B":r=10053324;break;case"M":r=16724736;break;case"W":r=10040166;break;case"S":r=16724940;break;case"U":r=10027008;break;case"G":r=16711782}regionBlockGroup.children[a].material.color.set(r),regionBlockGroup.children[a].material.opacity=.7}},dataOfLineLabel=[],lineShowIndex=[0,1,2,3,4,5,6],chaoliuData={geometry:null,vertices:[]},drawLine=function(e){var a=!1;if("show"==e){var r=17545.309,i=65811.8395,o=20904.8089,n=62787.9504,t=112.553929,s=37.894187,u=112.592161,l=37.866492;if(lineGroup.visible=!0,chaoliuData.geometry=new THREE.BufferGeometry,0==lineGroup.children.length){for(var c=shudianxian3,d=0;d<c.features.length;d++)if("LineString"==c.features[d].geometry.type){var g=c.features[d].properties.Layer,p=new THREE.BufferGeometry,h=[],m=new THREE.LineGeometry,b=c.features[d].geometry.coordinates,A="orange",G=(c.features[d].properties.EntityHandle,getNameAndColorOfLine(g));A=G[0];var y=G[1],L=3==G.length?G[2]:"未知";if(3!=G.length||"方案"!=G[2])if(a&&(A="orange"),A=getColorByStation(L),getShowByStation(L)){for(var f=getIndexByStation(L),K=[],E=0;E<b.length;E++){var M=t+(b[E][0]-r)/(o-r)*(u-t),w=l+(b[E][1]-n)/(i-n)*(s-l),v=MercatorGetXbyLongitude(M),x=MercatorGetYbyLatitude(w);if(h.push(v,0,0-x),0<E){var T=t+(b[E-1][0]-r)/(o-r)*(u-t),C=l+(b[E-1][1]-n)/(i-n)*(s-l),O=MercatorGetXbyLongitude(T),j=MercatorGetYbyLatitude(C);K.push(),K.push(),dataOfLineLabel.push({x:(v+O)/2,z:-(x+j)/2,nameV:y,colorR:A,indexV:f});var R=Math.sqrt((v-O)*(v-O)+(x-j)*(x-j));if(.5<R)(function(e,a,r,i,o){for(var n=0;n<e;n++)for(var t=0;t<chaoliufenxiGroupCount;t++)chaoliuFenxiData[t].push((chaoliufenxiGroupCount*n+t)/(chaoliufenxiGroupCount*e)*(i-a)+a),chaoliuFenxiData[t].push((chaoliufenxiGroupCount*n+t)/(chaoliufenxiGroupCount*e)*(o-r)+r)})(Math.ceil(R/.5),O,j,v,x);else(function(e,a,r,i,o){for(var n=0;n<e;n++)for(var t=0;t<chaoliufenxiGroupCount;t++)chaoliuFenxiData[t].push((chaoliufenxiGroupCount*n+t)/(chaoliufenxiGroupCount*e)*(i-a)+a),chaoliuFenxiData[t].push((chaoliufenxiGroupCount*n+t)/(chaoliufenxiGroupCount*e)*(o-r)+r)})(1,O,j,v,x)}}p.addAttribute("position",new THREE.Float32BufferAttribute(h,3)),m.setPositions(h);var H,B=new THREE.LineBasicMaterial({color:A,linewidth:1,transparent:!0,opacity:0});(H=new THREE.LineMaterial({color:A,linewidth:.003})).depthTest=!1;var k,D=new THREE.Line(p,B);if(D.Tag={name:y,station:L},(k=new THREE.Line2(m,H)).computeLineDistances(),k.Tag={name:y,voltage:"",indexV:f,colorR:A},k.renderOrder=99,k.scale.set(1,1,1),lineGroup.add(D),lineGroup.add(k),""==y){if(!a){var S="case '"+g+"':\r{\r{ return ['green', '', ''] };}; break;";console.log("EntityHandle",S)}a=!0}}}}else lineGroup.visible=!0}else"hide"==e&&(lineGroup.visible=!1);updateLabelOfLine()},drawChaoliufenxi=function(e){if("show"==e)animateChaoliuFenxi=function(){for(var e=Date.now()%900,a=0;a<chaoliuFenxiData.length;a++)e<900/chaoliuFenxiData.length*a&&e>900/chaoliuFenxiData.length*(a-1)?chaoliufenxiGroup[a].visible=!0:chaoliufenxiGroup[a].visible=!1};else if("hide"==e){for(var a=0;a<chaoliuFenxiData.length;a++)chaoliufenxiGroup[a].visible=!1;animateChaoliuFenxi=function(){}}function r(e,a){for(var r=new THREE.BufferGeometry,i=e.length/2,o=new Float32Array(3*i),n=new Float32Array(3*i),t=0;t<i;t++)o[3*t]=e[2*t+0],o[3*t+1]=.04,o[3*t+2]=-e[2*t+1],n[3*t]=0,n[3*t+1]=0,n[3*t+2]=255;r.addAttribute("position",new THREE.BufferAttribute(o,3)),r.addAttribute("color",new THREE.BufferAttribute(n,3)),r.computeBoundingBox();var s=new THREE.PointsMaterial({size:.08,vertexColors:THREE.VertexColors}),u=new THREE.Points(r,s);a.add(u)}for(a=0;a<chaoliuFenxiData.length;a++)r(chaoliuFenxiData[a],chaoliufenxiGroup[a])},animateChaoliuFenxi=function(){for(var e=Date.now()%900,a=0;a<chaoliuFenxiData.length;a++)e<900/chaoliuFenxiData.length*a&&e>900/chaoliuFenxiData.length*(a-1)?chaoliufenxiGroup[a].visible=!0:chaoliufenxiGroup[a].visible=!1},searchLineByIndex=function(e){if(lineShowIndex=e,lineGroup.visible)for(var a=0;a<lineGroup.children.length;a++)"Line2"==lineGroup.children[a].type&&(0<=e.indexOf(lineGroup.children[a].Tag.indexV)?lineGroup.children[a].visible=!0:lineGroup.children[a].visible=!1);updateLabelOfLine()},searchLineByName=function(e){if(lineGroup.visible){for(var a=0;a<lineGroup.children.length;a++)"Line2"==lineGroup.children[a].type&&(0<=lineGroup.children[a].Tag.name.search(e)?(lineGroup.children[a].material.color.set(16776960),lineGroup.children[a].material.opacity=.6,lineGroup.children[a].material.transparent=!0):(lineGroup.children[a].material.color.set(lineGroup.children[a].Tag.colorR),lineGroup.children[a].material.transparent=!1));if(""==e)for(a=0;a<lineGroup.children.length;a++)"Line2"==lineGroup.children[a].type&&(lineGroup.children[a].material.color.set(lineGroup.children[a].Tag.colorR),lineGroup.children[a].material.transparent=!1)}},guanGouObj={matLineDashed:new THREE.LineDashedMaterial({vertexColors:THREE.VertexColors,scale:2,dashSize:1,gapSize:1}),matLine:new THREE.LineMaterial({color:"orange",linewidth:.01,vertexColors:THREE.VertexColors,dashed:!1})},drawLine2=function(e){if("show"==e){var a=17545.309,r=65811.8395,i=20904.8089,o=62787.9504,n=112.553929,t=37.894187,s=112.592161,u=37.866492;if(guangouGroup.visible=!0,0==guangouGroup.children.length){for(var l=guangouData,c=0;c<l.features.length;c++)if("LineString"==l.features[c].geometry.type){var d=l.features[c].properties.Layer,g=[],p=new THREE.LineGeometry,h=l.features[c].geometry.coordinates,m="blue";"a01"==d&&(m="skyblue");for(var b=0;b<h.length;b++){var A=n+(h[b][0]-a)/(i-a)*(s-n),G=u+(h[b][1]-o)/(r-o)*(t-u),y=MercatorGetXbyLongitude(A),L=MercatorGetYbyLatitude(G);g.push(y,0,0-L)}p.setPositions(g);var f=new THREE.LineMaterial({color:m,linewidth:.003});f.depthTest=!1;var K=new THREE.Line2(p,f);K.computeLineDistances(),K.Tag={name:"",voltage:"",indexV:"",colorR:m},K.renderOrder=99,K.scale.set(1,1,1),guangouGroup.add(K)}}else guangouGroup.visible=!0}else"hide"==e&&(guangouGroup.visible=!1)},drawBiandiansuo=function(e){if("show"==e)if(biandiansuoGroup.visible=!0,0==biandiansuoGroup.children.length)for(var a=17545.309,r=65811.8395,i=20904.8089,o=62787.9504,n=112.553929,t=37.894187,s=112.592161,u=37.866492,l=biandiansuo2,c=0;c<l.length;c++){var d=document.createElement("div"),g=document.createElement("img");g.src="Pic/biandianzhan110kv.png",d.appendChild(g),d.className="biandianzhanTuPian";var p="0xffff00";switch(l[c].name){case"东大变":p="red";break;case"杏花岭变":p="purple";break;case"柳溪变电站":p="orange";break;case"城西站":p="purple";break;case"铜锣湾变":case"城北站":p="orange";break;case"解放变":p="purple"}switch(p=getColorByStation(l[c].name),l[c].v){case"110kv":var h=n+(l[c].position[0]-a)/(i-a)*(s-n),m=u+(l[c].position[1]-o)/(r-o)*(t-u),b=MercatorGetXbyLongitude(h),A=MercatorGetYbyLatitude(m),G=showAConfig.biandianzhan.l110kv.radius,y=p,L=new THREE.RingGeometry(G,.75*G,18);(E=new THREE.MeshBasicMaterial({color:y,side:THREE.DoubleSide})).depthTest=!1;var f=new THREE.Mesh(L,E),K={x:b,y:0,z:-A};f.Tag={name:l[c].name,position:K},f.renderOrder=98,f.position.set(b,0,-A),f.rotateX(Math.PI/2),biandiansuoGroup.add(f),(v=document.createElement("div")).className="labelbiandianzhan",v.textContent=l[c].name,v.style.marginTop="-1em",v.style.color=Number.isInteger(p)?get16(p):p,(x=new THREE.CSS2DObject(v)).position.set(b,0,-A),x.positionTag=[b,0,-A],biandiansuoGroup.add(x);break;case"220kv":G=showAConfig.biandianzhan.l220kv.radius,y=p,h=n+(l[c].position[0]-a)/(i-a)*(s-n),m=u+(l[c].position[1]-o)/(r-o)*(t-u),b=MercatorGetXbyLongitude(h),A=MercatorGetYbyLatitude(m);var E,M=new THREE.RingGeometry(G,.75*G,18);(E=new THREE.MeshBasicMaterial({color:y,side:THREE.DoubleSide})).depthTest=!1;var w=new THREE.Mesh(M,E);w.name=l[c].name;K={x:b,y:0,z:-A};w.Tag={name:l[c].name,position:K},w.renderOrder=98,w.position.set(b,0,-A),w.rotateX(Math.PI/2),biandiansuoGroup.add(w);var v,x,T=new THREE.RingGeometry(.5*G,.25*G,18),C=new THREE.Mesh(T,E);C.Tag={name:l[c].name,position:K},C.renderOrder=98,C.position.set(b,0,-A),C.rotateX(Math.PI/2),biandiansuoGroup.add(C),(v=document.createElement("div")).className="labelbiandianzhan",v.textContent=l[c].name,v.style.marginTop="-1em",v.style.color=Number.isInteger(p)?get16(p):p,(x=new THREE.CSS2DObject(v)).position.set(b,0,-A),x.positionTag=[b,0,-A],biandiansuoGroup.add(x)}}else{searchBiandiansuo("BB");for(c=0;c<biandiansuoGroup.children.length;c++)biandiansuoGroup.children[c].positionTag&&biandiansuoGroup.children[c].position.set(biandiansuoGroup.children[c].positionTag[0],biandiansuoGroup.children[c].positionTag[1],biandiansuoGroup.children[c].positionTag[2])}else if("hide"==e){biandiansuoGroup.visible=!1;for(c=0;c<biandiansuoGroup.children.length;c++)biandiansuoGroup.children[c].positionTag&&biandiansuoGroup.children[c].position.set(0,0,0)}},searchBiandiansuo=function(e){for(var a=0;a<biandiansuoGroup.children.length;a++)"Mesh"==biandiansuoGroup.children[a].type&&biandiansuoGroup.children[a].Tag.name==e&&controls.target.set(biandiansuoGroup.children[a].Tag.position.x,biandiansuoGroup.children[a].Tag.position.y,biandiansuoGroup.children[a].Tag.position.z)},drawBuildings=function(e){if("show"==e){if(buildingsGroups.visible=!0,0==buildingsGroups.children.length){var a=new THREE.LoadingManager;new THREE.MTLLoader(a).setPath("ObjTag/shenggongsi/").load("build1.mtl",function(e){e.preload(),new THREE.OBJLoader(a).setMaterials(e).setPath("ObjTag/shenggongsi/").load("build1.obj",function(e){for(var a=0;a<e.children.length;a++)if(e.children[a].isMesh)for(var r=0;r<e.children[a].material.length;r++)e.children[a].material[r].side=THREE.DoubleSide;e.position.y=0,scene.add(e),e.rotateX(-Math.PI/2),e.rotateZ(-.07);var i={x:MercatorGetXbyLongitude(112.5782425),y:0,z:-MercatorGetYbyLatitude(37.87923660278321)};e.position.set(MercatorGetXbyLongitude(112.5782425),0,-MercatorGetYbyLatitude(37.87923660278321)),e.scale.set(.015,.015,.015),e.castShadow=!0,e.receiveShadow=!0,e.name="build1",e.Tag={name:"省公司",position:i},e.rotateX(Math.PI/2),buildingsGroups.add(e)},function(){},function(){})}),new THREE.MTLLoader(a).setPath("ObjTag/shimao/").load("build2.mtl",function(e){e.preload(),new THREE.OBJLoader(a).setMaterials(e).setPath("ObjTag/shimao/").load("build2.obj",function(e){for(var a=0;a<e.children.length;a++)if(e.children[a].isMesh)for(var r=0;r<e.children[a].material.length;r++)e.children[a].material[r].side=THREE.DoubleSide;e.position.y=0,scene.add(e),e.rotateX(-Math.PI/2),e.rotateZ(-.03);var i={x:MercatorGetXbyLongitude(112.56329469612449),y:0,z:-MercatorGetYbyLatitude(37.88009395599366)};e.position.set(MercatorGetXbyLongitude(112.56329469612449),0,-MercatorGetYbyLatitude(37.88009395599366)),e.scale.set(.095,.095,.095),e.castShadow=!0,e.receiveShadow=!0,e.name="build2",e.Tag={name:"世贸",position:i},e.rotateX(Math.PI/2),buildingsGroups.add(e)},function(){},function(){})}),new THREE.MTLLoader(a).setPath("ObjTag/build4/").load("build4fujia.mtl",function(e){e.preload(),new THREE.OBJLoader(a).setMaterials(e).setPath("ObjTag/build4/").load("build4fujia.obj",function(e){for(var a=0;a<e.children.length;a++)if(e.children[a].isMesh)for(var r=0;r<e.children[a].material.length;r++)e.children[a].material[r].side=THREE.DoubleSide;e.position.y=0,scene.add(e),e.rotateX(-Math.PI/2),e.rotateZ(-.03);var i={x:MercatorGetXbyLongitude(112.5574),y:0,z:-MercatorGetYbyLatitude(37.8927)};e.position.set(MercatorGetXbyLongitude(112.5574),0,-MercatorGetYbyLatitude(37.8927)),e.scale.set(.02,.035,.025),e.castShadow=!0,e.receiveShadow=!0,e.name="mj1",e.Tag={name:"民居1",position:i},e.rotateX(Math.PI/2),buildingsGroups.add(e);var o=e.clone();i={x:MercatorGetXbyLongitude(112.5574),y:0,z:-MercatorGetYbyLatitude(37.8917)};o.name="mj2",o.Tag={name:"民居2",position:i},o.position.set(MercatorGetXbyLongitude(112.5574),0,-MercatorGetYbyLatitude(37.8917)),buildingsGroups.add(o);var n=e.clone();i={x:MercatorGetXbyLongitude(112.5575),y:0,z:-MercatorGetYbyLatitude(37.8907)};n.name="mj3",n.Tag={name:"民居3",position:i},n.position.set(MercatorGetXbyLongitude(112.5575),0,-MercatorGetYbyLatitude(37.8907)),buildingsGroups.add(n);var t=e.clone();i={x:MercatorGetXbyLongitude(112.5575),y:0,z:-MercatorGetYbyLatitude(37.8897)};t.name="mj4",n.Tag={name:"民居4",position:i},t.position.set(MercatorGetXbyLongitude(112.5575),0,-MercatorGetYbyLatitude(37.8897)),buildingsGroups.add(t);var s=e.clone();i={x:MercatorGetXbyLongitude(112.5575),y:0,z:-MercatorGetYbyLatitude(37.8875)};s.name="mj5",s.position.set(MercatorGetXbyLongitude(112.5575),0,-MercatorGetYbyLatitude(37.8875)),buildingsGroups.add(s);var u=e.clone();u.position.set(MercatorGetXbyLongitude(112.5575),0,-MercatorGetYbyLatitude(37.8868)),buildingsGroups.add(u);var l=e.clone();l.position.set(MercatorGetXbyLongitude(112.5576),0,-MercatorGetYbyLatitude(37.88601)),buildingsGroups.add(l);var c=e.clone();c.position.set(MercatorGetXbyLongitude(112.5576),0,-MercatorGetYbyLatitude(37.88521)),buildingsGroups.add(c)},function(){},function(){})}),new THREE.MTLLoader(a).setPath("ObjTag/wandaxiugai/").load("wandagcxiugai.mtl",function(e){e.preload(),new THREE.OBJLoader(a).setMaterials(e).setPath("ObjTag/wandaxiugai/").load("wandagcxiugai.obj",function(e){for(var a=0;a<e.children.length;a++)if(e.children[a].isMesh)for(var r=0;r<e.children[a].material.length;r++)e.children[a].material[r].side=THREE.DoubleSide;e.position.y=0,scene.add(e),e.rotateX(-Math.PI/2),e.rotateZ(Math.PI/2);var i={x:MercatorGetXbyLongitude(112.56774847960612),y:.001,z:-MercatorGetYbyLatitude(37.88849601745606)};e.position.set(MercatorGetXbyLongitude(112.56774847960612),.001,-MercatorGetYbyLatitude(37.88849601745606)),e.scale.set(.09,.09,.09),e.castShadow=!0,e.receiveShadow=!0,e.name="wd",e.Tag={name:"万达广场",position:i},e.rotateX(Math.PI/2),buildingsGroups.add(e)},function(){},function(){})});new THREE.STLLoader;0}}else"hide"==e&&(buildingsGroups.visible=!1)},searchBuildings=function(e){for(var a=0;a<buildingsGroups.children.length;a++)buildingsGroups.children[a].Tag.name==e&&controls.target.set(buildingsGroups.children[a].Tag.position.x,buildingsGroups.children[a].Tag.position.y,buildingsGroups.children[a].Tag.position.z)},setupCanvasDrawing=function(){mapTexture=new THREE.CanvasTexture(ctx.canvas),mapTexture.needsUpdate=!0,mapGroup.children[0].material.map=mapTexture},get16=function(e){for(var a="",r=0;r<6;r++){switch(e%16){case 0:a="0"+a;break;case 1:a="1"+a;break;case 2:a="2"+a;break;case 3:a="3"+a;break;case 4:a="4"+a;break;case 5:a="5"+a;break;case 6:a="6"+a;break;case 7:a="7"+a;break;case 8:a="8"+a;break;case 9:a="9"+a;break;case 10:a="a"+a;break;case 11:a="b"+a;break;case 12:a="c"+a;break;case 13:a="d"+a;break;case 14:a="e"+a;break;case 15:a="f"+a}e>>=4}return a="#"+a},visibleOfLabelOfLine=!1,showLabelOfLine=function(){for(var e=0;e<dataOfLineLabel.length;e++){var a=dataOfLineLabel[e].x,r=dataOfLineLabel[e].z,i=document.createElement("div");i.className="labelline",i.textContent=dataOfLineLabel[e].nameV,i.style.marginTop="-1em";var o=dataOfLineLabel[e].colorR;i.style.color=Number.isInteger(o)?get16(o):o;var n=new THREE.CSS2DObject(i);n.position.set(a,0,r),n.positionTag=[a,0,r],lineLabelGroup.add(n)}},clearLabelOfLine=function(){for(var e=lineLabelGroup.children.length-1;0<=e;e--)lineLabelGroup.remove(lineLabelGroup.children[e])},updateLabelOfLine=function(){if(0==arguments.length){if(0<dataOfLineLabel.length)if(lineGroup.visible){var e=(mercatoCenter.x-7)*Math.pow(2,19-mercatoCenter.zoom),a=(mercatoCenter.x+7)*Math.pow(2,19-mercatoCenter.zoom),r=(mercatoCenter.zValue-7)*Math.pow(2,19-mercatoCenter.zoom),i=(mercatoCenter.zValue+7)*Math.pow(2,19-mercatoCenter.zoom);clearLabelOfLine();for(var o=0;o<dataOfLineLabel.length;o++){var n=dataOfLineLabel[o].x,t=dataOfLineLabel[o].z,s=(n>>19-mercatoCenter.zoom+1)+"_"+(t>>19-mercatoCenter.zoom+1)+"_"+chineseToNumStr(dataOfLineLabel[o].nameV);if(e<=n&&n<=a&&r<=t&&t<=i&&0<=lineShowIndex.indexOf(dataOfLineLabel[o].indexV)&&!lineLabelGroup.getObjectByName(s)){var u=getXianShunByName(dataOfLineLabel[o].nameV);if(50<=u){(c=document.createElement("div")).className="labelline",c.textContent=dataOfLineLabel[o].nameV+"(线损"+u/10+"%)",c.style.marginTop="-1em";var l=dataOfLineLabel[o].colorR;c.style.borderColor="red",c.style.color="red",(d=new THREE.CSS2DObject(c)).position.set(n,0,t),d.positionTag=[n,0,t],d.name=s,lineLabelGroup.add(d)}else{var c;(c=document.createElement("div")).className="labelline",c.textContent=dataOfLineLabel[o].nameV,c.style.marginTop="-1em";var d;l=dataOfLineLabel[o].colorR;c.style.borderColor=Number.isInteger(l)?get16(l):l,(d=new THREE.CSS2DObject(c)).position.set(n,0,t),d.positionTag=[n,0,t],d.name=s,lineLabelGroup.add(d)}}}}else clearLabelOfLine()}else 1==arguments.length&&console.log("a",arguments[0])},chineseToNumStr=function(e){for(var a="",r=0;r<e.length;r++)""==a?a=e.charCodeAt(r).toString(16):a+="_"+e.charCodeAt(r).toString(16);return a};